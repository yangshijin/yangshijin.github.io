<!DOCTYPE html><html lang="#{config.language}"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>基于python3.x+opencv3的hsv颜色+轮廓法车牌粗定位 | 小谨的随笔</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">基于python3.x+opencv3的hsv颜色+轮廓法车牌粗定位</h1><a id="logo" href="/.">小谨的随笔</a><p class="description">热爱工作、享受生活、专注技术</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">基于python3.x+opencv3的hsv颜色+轮廓法车牌粗定位</h1><div class="post-meta">Apr 15, 2017</div><div class="post-content"><h5 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h5><p>　　上一篇文章将了基于图像学sobel算子等图像处理的边缘检测法通过轮廓检测进行车牌粗定位，结尾也说了，这种方法有可能出现错误定位，或者定位出多个区域，今天我们来试试通过将图片转换成hsv模式，看看是否能通过色调区域方法找到车牌区域，从而完成车牌粗定位。<br><a id="more"></a></p>
<h6 id="1-_u52A0_u8F7D_u56FE_u7247_uFF0C_u8F6C_u6362_u6210hsv_u6A21_u5F0F"><a href="#1-_u52A0_u8F7D_u56FE_u7247_uFF0C_u8F6C_u6362_u6210hsv_u6A21_u5F0F" class="headerlink" title="1.加载图片，转换成hsv模式"></a>1.加载图片，转换成hsv模式</h6><p>　　HSV(Hue, Saturation, Value)是根据颜色的直观特性由A. R. Smith在1978年创建的一种颜色空间, 也称六角锥体模型(Hexcone Model)。这个模型中颜色的参数分别是：色调（H），饱和度（S），明度（V）。</p>
<p>　　对图形图像学没有太多了解的朋友可能比较少听过HSV模型，更多听到的是RGB模型，或者RGBA模型，和RGB模型这种三维坐标的颜色模型不同的是，HSV模型，是针对用户观感的一种颜色模型，侧重于色彩表示，什么颜色、深浅如何、明暗如何。H是色彩，S是深浅， S = 0时，只有灰度，V是明暗，表示色彩的明亮程度，但与光强无直接联系。</p>
<p>　　opencv提供了这样一个方法，可以直接将rgb模式的图片转换成hsv模式的图片，方法为cv2.cvtColor(img, cv2.COLOR_BGR2HSV),也就是转换成灰度图的方法，只是参数不一样。</p>
<h6 id="2-__u5B9A_u4E49_u8F66_u724C_u7684hsv_u533A_u95F4"><a href="#2-__u5B9A_u4E49_u8F66_u724C_u7684hsv_u533A_u95F4" class="headerlink" title="2. 定义车牌的hsv区间"></a>2. 定义车牌的hsv区间</h6><p>　　这里不对HSV模型进行深入讲解，有兴趣的同学可以直接google一下，资料很多，这里我们只需要找到车牌的hsv颜色区间，假设只对蓝底白字车牌进行定位，那么颜色空间就是：H区间：[100,140] , S区间：[50,255] , V区间：[50,255] ，S和V之所以跨度这么大，是因为不同的时间、光照、摄像机拍出来的效果值可能差距会比较大。</p>
<h6 id="3-_u627E_u5230_u56FE_u4E2D_u5305_u542B_u8FD9_u4E2Ahsv_u533A_u95F4_u7684_u6240_u6709_u50CF_u7D20"><a href="#3-_u627E_u5230_u56FE_u4E2D_u5305_u542B_u8FD9_u4E2Ahsv_u533A_u95F4_u7684_u6240_u6709_u50CF_u7D20" class="headerlink" title="3.找到图中包含这个hsv区间的所有像素"></a>3.找到图中包含这个hsv区间的所有像素</h6><p>　　遍历经过转换成hsv模式图片的所有像素点，将所有处于这个颜色区间的像素点标识出来，置为1（255）,不处于这个颜色区间的像素点置为0,从而形成了一张二值化的图片。<br>　　opencv提供了这样的一个方法，因此我们不需要手动编码去遍历图片的所有像素，方法为：cv2.inRange(hsv_img, lower_color, higher_color).第一个参数为hsv模式的图片，第二个参数为颜色区间的最低值，第三个参数为颜色区间的最大值。效果如下：</p>
<p><img src="/img/hsv2binary.jpg" alt=""></p>
<h6 id="4-_u77E9_u5F62_u94FE_u63A5_u3001_u566A_u70B9_u5904_u7406"><a href="#4-_u77E9_u5F62_u94FE_u63A5_u3001_u566A_u70B9_u5904_u7406" class="headerlink" title="4.矩形链接、噪点处理"></a>4.矩形链接、噪点处理</h6><p>　　由步骤三得到的二值化图可知，绝大部分图片具有蓝色区间的区域不仅仅是在车牌处，其他的地方也有可能具有这个颜色的像素点，甚至蓝色的标识牌、蓝色的车身会极大的干扰到车牌的定位。<br>　　由于车牌字体肯定不属于蓝色区间，这里我们首先要做的就是将蓝色的车牌矩形处中间由于车牌号而镂空的地方链接起来，因此首先进行一轮闭操作，闭操作原理上一篇文章有讲过。效果如下：</p>
<p><img src="/img/hsv-closed.jpg" alt=""></p>
<p>　　可以看到车牌区域中间镂空的预期已经补齐，接下来去除细小噪点，原理同样在上一篇文章有讲过，即开操作，先对图片进行腐蚀，再进膨胀，去除掉细小的像素点。效果如下：</p>
<p><img src="/img/hsv-opened.jpg" alt=""></p>
<h6 id="5-_u8FDB_u884C_u8FB9_u7F18_u68C0_u6D4B_uFF0C_u5BFB_u627E_u56FE_u4E2D_u6240_u6709_u77E9_u5F62"><a href="#5-_u8FDB_u884C_u8FB9_u7F18_u68C0_u6D4B_uFF0C_u5BFB_u627E_u56FE_u4E2D_u6240_u6709_u77E9_u5F62" class="headerlink" title="5.进行边缘检测，寻找图中所有矩形"></a>5.进行边缘检测，寻找图中所有矩形</h6><p>　　对二值化图像进行链接、去燥处理后，图片已经很干净，这里直接用上一篇文章用到的形态学方法，寻找图中矩形，然后进行过滤判断，最终定位到车牌区域，效果如下：</p>
<p><img src="/img/hsv-result.jpg" alt=""></p>
<p>PS：同样的，这里只是粗定位，而且是只针对蓝底车牌的粗定位，像其他黄底、黑底、白底的车牌，在这里没有任何可能定位出来，另外，即使是蓝底车牌还是有可能定位到多个矩形区域，或者干脆定位不到车牌区域，因此，要保持较高的识别率，仅仅使用hsv模式定位是不行的，可能通过结合上一篇文章讲到的边缘检测的识别方法，来对车牌进行一个定位，这样能保持比较高的识别率。</p>
<h6 id="6-_u5B9E_u73B0_u4EE3_u7801_uFF1A"><a href="#6-_u5B9E_u73B0_u4EE3_u7801_uFF1A" class="headerlink" title="6.实现代码："></a>6.实现代码：</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义蓝底车牌的hsv颜色区间</span></span><br><span class="line">lower_blue = np.array([<span class="number">100</span>, <span class="number">50</span>, <span class="number">50</span>])</span><br><span class="line">higher_blue = np.array([<span class="number">140</span>, <span class="number">255</span>, <span class="number">255</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到符合车牌形状的矩形</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findPlateNumberRegion</span><span class="params">(img)</span>:</span></span><br><span class="line">    region = []</span><br><span class="line">    <span class="comment"># 查找外框轮廓</span></span><br><span class="line">    contours_img, contours, hierarchy = cv2.findContours(img, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)</span><br><span class="line">    print(<span class="string">"contours lenth is :%s"</span> % (len(contours)))</span><br><span class="line">    <span class="comment"># 筛选面积小的</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(contours)):</span><br><span class="line">        cnt = contours[i]</span><br><span class="line">        <span class="comment"># 计算轮廓面积</span></span><br><span class="line">        area = cv2.contourArea(cnt)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 面积小的忽略</span></span><br><span class="line">        <span class="keyword">if</span> area &lt; <span class="number">2000</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 转换成对应的矩形（最小）</span></span><br><span class="line">        rect = cv2.minAreaRect(cnt)</span><br><span class="line">        <span class="comment"># print("rect is:%s" % &#123;rect&#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据矩形转成box类型，并int化</span></span><br><span class="line">        box = np.int32(cv2.boxPoints(rect))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算高和宽</span></span><br><span class="line">        height = abs(box[<span class="number">0</span>][<span class="number">1</span>] - box[<span class="number">2</span>][<span class="number">1</span>])</span><br><span class="line">        width = abs(box[<span class="number">0</span>][<span class="number">0</span>] - box[<span class="number">2</span>][<span class="number">0</span>])</span><br><span class="line">        <span class="comment"># 正常情况车牌长高比在2.7-5之间,那种两行的有可能小于2.5，这里不考虑</span></span><br><span class="line">        ratio = float(width) / float(height)</span><br><span class="line">        <span class="keyword">if</span> ratio &gt; maxPlateRatio <span class="keyword">or</span> ratio &lt; minPlateRatio:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># 符合条件，加入到轮廓集合</span></span><br><span class="line">        region.append(box)</span><br><span class="line">    <span class="keyword">return</span> region</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    img = cv2.imread(<span class="string">"d:\\carImage\\car_02.jpg"</span>)</span><br><span class="line">    <span class="comment"># 转换成hsv模式图片</span></span><br><span class="line">    hsv_img = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找到hsv图片下的所有符合蓝底颜色区间的像素点，转换成二值化图像</span></span><br><span class="line">    in_range_array = cv2.inRange(hsv_img, lower_blue, higher_blue)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 进行闭操作，链接车牌区域</span></span><br><span class="line">    element = cv2.getStructuringElement(cv2.MORPH_RECT, (<span class="number">17</span>, <span class="number">3</span>))</span><br><span class="line">    closed = cv2.morphologyEx(in_range_array, cv2.MORPH_CLOSE, element)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 进行开操作，去除细小噪点</span></span><br><span class="line">    eroded = cv2.erode(closed, <span class="keyword">None</span>, iterations=<span class="number">2</span>)</span><br><span class="line">    dilation = cv2.dilate(eroded, <span class="keyword">None</span>, iterations=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查找并筛选符合条件的矩形区域</span></span><br><span class="line">    region = findPlateNumberRegion(dilation)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 标识出所有符合条件的矩形区域</span></span><br><span class="line">    <span class="keyword">if</span> len(region) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(region)):</span><br><span class="line">            box = region[i]</span><br><span class="line">            rect_img = findRectImg(box, tmp_img)</span><br><span class="line">            rect_imgs.append(rect_img)</span><br><span class="line">            cv2.drawContours(img, [box], <span class="number">0</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">"img"</span>, img)</span><br></pre></td></tr></table></figure>
<p>　　</p>
</div><div class="tags"><a href="/tags/python/">python</a><a href="/tags/opencv/">opencv</a><a href="/tags/车牌识别/">车牌识别</a><a href="/tags/机器学习/">机器学习</a></div><div class="post-nav"><a class="next" href="/2017/04/11/基于python3-x-opencv3的图像学轮廓方法车牌粗定位/">基于python3.x + opencv3的图像学轮廓方法车牌粗定位</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="#{config.url}"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/myBatis/" style="font-size: 15px;">myBatis</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/opencv/" style="font-size: 15px;">opencv</a> <a href="/tags/车牌识别/" style="font-size: 15px;">车牌识别</a> <a href="/tags/日常问题/" style="font-size: 15px;">日常问题</a> <a href="/tags/感悟/" style="font-size: 15px;">感悟</a> <a href="/tags/思维/" style="font-size: 15px;">思维</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/技术/" style="font-size: 15px;">技术</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/设计原则/" style="font-size: 15px;">设计原则</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/基于python3-x-opencv3的hsv颜色-轮廓法车牌粗定位/">基于python3.x+opencv3的hsv颜色+轮廓法车牌粗定位</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/基于python3-x-opencv3的图像学轮廓方法车牌粗定位/">基于python3.x + opencv3的图像学轮廓方法车牌粗定位</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/设计杂谈-一种链式生命周期管理设计/">设计杂谈:一种链式生命周期管理设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/myBatis中的Spring技术探究：SqlSessionFacotry之InitializingBean（Spring容器加载bean过程中的钩子简析）/">myBatis中的Spring技术探究：SqlSessionFacotry之InitializingBean（Spring容器加载bean过程中的钩子简析）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/24/沉寂一年的结构化思维/">沉寂一年的结构化思维</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/18/myBatis中的Spring技术探究：SqlSessionFactoryBean之FactoryBean/">myBatis中的Spring技术探究：SqlSessionFactoryBean之FactoryBean</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/使用myBatis配置多个sqlSessionFactory引发的第三方数据库连接池爆满后超时的BUG探究 - 副本/">使用myBatis配置多个sqlSessionFactory引发的第三方数据库连接池爆满后超时的BUG探究</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/13/Intellij-Idea-Method-threw-java-lang-NullPointerException-exception-Cannot-evaluate-XXXX-toString-引出的问题探究/">Intellij Idea Method threw java.lang.NullPointerException exception. Cannot evaluate XXXX.toString()引出的问题探究</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/浅谈设计模式：适配器模式（Adapter-Pattern）/">浅谈设计模式：适配器模式（Adapter Pattern）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/浅谈设计模式：装饰器模式（Decorator-Pattern）/">浅谈设计模式：装饰器模式（Decorator Pattern）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">小谨的随笔.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>